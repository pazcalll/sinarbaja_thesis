<!-- Footer -->
<footer class="site-footer" style="margin: 0px;">
    <div class="site-footer-legal">Â© 2021 <a href="http://themeforest.net/item/remark-responsive-bootstrap-admin-template/11989202">Remark</a></div>
    <div class="site-footer-right">
        Crafted with <i class="red-600 icon md-favorite"></i> by <a href="https://themeforest.net/user/creation-studio">AGSATU</a>
    </div>
</footer>

<!-- Core  -->
<script src="{{ asset('public/themeforest/global/vendor/babel-external-helpers/babel-external-helpers.js') }}">
</script>
<script type="text/javascript" src="{{asset('node_modules\sweetalert2\dist\sweetalert2.all.min.js')}}"></script>
<script src="{{ asset('public/themeforest/global/vendor/jquery/jquery.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/popper-js/umd/popper.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/bootstrap/bootstrap.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/animsition/animsition.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/mousewheel/jquery.mousewheel.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/asscrollbar/jquery-asScrollbar.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/asscrollable/jquery-asScrollable.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/ashoverscroll/jquery-asHoverScroll.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/waves/waves.js') }}"></script>

<!-- Plugins -->
<script src="{{ asset('public/themeforest/global/vendor/switchery/switchery.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/intro-js/intro.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/screenfull/screenfull.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/slidepanel/jquery-slidePanel.js') }}"></script>
{{-- <script src="{{ asset('public/themeforest/global/vendor/jvectormap/jquery-jvectormap.min.js') }}"></script> --}}
{{-- <script src="{{ asset('public/themeforest/global/vendor/jvectormap/maps/jquery-jvectormap-world-mill-en.js') }}"> --}}
</script>
<script src="{{ asset('public/themeforest/global/vendor/matchheight/jquery.matchHeight-min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/peity/jquery.peity.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net/jquery.dataTables.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-bs4/dataTables.bootstrap4.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-fixedheader/dataTables.fixedHeader.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-fixedcolumns/dataTables.fixedColumns.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-rowgroup/dataTables.rowGroup.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-scroller/dataTables.scroller.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-responsive/dataTables.responsive.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-responsive-bs4/responsive.bootstrap4.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-buttons/dataTables.buttons.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-buttons/buttons.html5.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-buttons/buttons.flash.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-buttons/buttons.print.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-buttons/buttons.colVis.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datatables.net-buttons-bs4/buttons.bootstrap4.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/asrange/jquery-asRange.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/bootbox/bootbox.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/select2/select2.full.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/bootstrap-tokenfield/bootstrap-tokenfield.min.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/bootstrap-tagsinput/bootstrap-tagsinput.min.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/bootstrap-select/bootstrap-select.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/icheck/icheck.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/switchery/switchery.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/asrange/jquery-asRange.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/ionrangeslider/ion.rangeSlider.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/asspinner/jquery-asSpinner.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/clockpicker/bootstrap-clockpicker.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/ascolor/jquery-asColor.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/asgradient/jquery-asGradient.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/ascolorpicker/jquery-asColorPicker.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/bootstrap-maxlength/bootstrap-maxlength.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/jquery-knob/jquery.knob.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/bootstrap-touchspin/bootstrap-touchspin.min.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/jquery-labelauty/jquery-labelauty.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/bootstrap-datepicker/bootstrap-datepicker.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/timepicker/jquery.timepicker.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datepair/datepair.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/datepair/jquery.datepair.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/jquery-strength/password_strength.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/jquery-strength/jquery-strength.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/multi-select/jquery.multi-select.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/typeahead-js/bloodhound.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/typeahead-js/typeahead.jquery.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/jquery-placeholder/jquery.placeholder.js') }}"></script>

{{-- Drop and upload image --}}
<script src="{{ asset('public/themeforest/global/vendor/jquery-ui/jquery-ui.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-tmpl/tmpl.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-canvas-to-blob/canvas-to-blob.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-load-image/load-image.all.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-file-upload/jquery.fileupload.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-file-upload/jquery.fileupload-process.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-file-upload/jquery.fileupload-image.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-file-upload/jquery.fileupload-audio.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-file-upload/jquery.fileupload-video.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-file-upload/jquery.fileupload-validate.js') }}">
</script>
<script src="{{ asset('public/themeforest/global/vendor/blueimp-file-upload/jquery.fileupload-ui.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/dropify/dropify.min.js') }}"></script>

<!-- Scripts -->
<script src="{{ asset('public/themeforest/global/js/Component.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Base.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Config.js') }}"></script>

<script src="{{ asset('public/themeforest/page-base/js/Section/Menubar.js') }}"></script>
<script src="{{ asset('public/themeforest/page-base/js/Section/GridMenu.js') }}"></script>
<script src="{{ asset('public/themeforest/page-base/js/Section/Sidebar.js') }}"></script>
<script src="{{ asset('public/themeforest/page-base/js/Section/PageAside.js') }}"></script>
<script src="{{ asset('public/themeforest/page-base/js/Plugin/menu.js') }}"></script>

<script src="{{ asset('public/themeforest/global/vendor/formvalidation/formValidation.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/formvalidation/framework/bootstrap4.min.js') }}"></script>

<script src="{{ asset('public/themeforest/global/js/config/colors.js') }}"></script>
<script src="{{ asset('public/themeforest/page-base/js/config/tour.js') }}"></script>
<script>
    Config.set('assets', '{{ asset('public/themeforest/page-base') }}');

    $(document).ready(function() {
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
    });
</script>

<!-- Page -->
<script src="{{ asset('public/themeforest/page-base/js/Site.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/asscrollable.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/slidepanel.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/switchery.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/matchheight.js') }}"></script>
{{-- <script src="{{ asset('public/themeforest/global/js/Plugin/jvectormap.js') }}"></script> --}}
<script src="{{ asset('public/themeforest/global/js/Plugin/peity.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/asselectable.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/selectable.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/table.js') }}"></script>

<script src="{{ asset('public/themeforest/global/js/Plugin/select2.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/select2.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/bootstrap-tokenfield.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/bootstrap-tagsinput.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/bootstrap-select.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/icheck.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/switchery.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/asrange.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/ionrangeslider.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/asspinner.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/clockpicker.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/ascolorpicker.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/bootstrap-maxlength.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/jquery-knob.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/bootstrap-touchspin.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/card.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/jquery-labelauty.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/bootstrap-datepicker.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/jt-timepicker.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/datepair.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/jquery-strength.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/multi-select.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/jquery-placeholder.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/dropify.js') }}"></script>

<script src="{{ asset('public/themeforest/page-base/examples/js/dashboard/v1.js') }}"></script>

<script src="{{ asset('public/themeforest/global/vendor/toastr/toastr.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/toastr.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/webui-popover/jquery.webui-popover.min.js') }}"></script>
<script src="{{ asset('public/themeforest/global/vendor/toolbar/jquery.toolbar.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/webui-popover.js') }}"></script>
<script src="{{ asset('public/themeforest/global/js/Plugin/toolbar.js') }}"></script>

<script src="{{ asset('public/themeforest/page-base/examples/js/uikit/tooltip-popover.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{{-- <script>
$(document).ready(function(){
  let user = {{Auth::user()->id}}
  if (user == 1) {
    $.ajax({
      type: "GET",
      url:  `{{route('count_harganull')}} `,
      success: function(data){
        console.log(data)
        $('#notifikasi').html(data.data)
      }
    });
  }
})
</script> --}}

<script>
    const KEY_SESSION_CART = 'cart'
    document.getElementById("btn-buy").disabled = true;
    var carts = []

    $(document).ready(function() {
        toastr.options = {
            positionClass: 'toast-bottom-right'
        }

        var json = $.getJSON({
            url: `{{ url('/session') }}/${KEY_SESSION_CART}`,
            type: 'GET',
            async: true
        }).then((res) => {
            let {
                data
            } = res
            carts = data
            updateCart(carts)
        })
        // console.log(currentAuth)
        // console.log(newHargaProduk)
    })


    function addToChart(product, qty, id) {
        console.log('push')
        exists = false
        console.log(product)
        if (carts != null && carts.length != 0) {
            carts.forEach((cart, index) => {
                if (cart.id == product.id) {
                    exists = true
                    newHargaProduk.forEach((item, index)=>{
                        if (cart.id_group == item.id_group && cart.id == item.id_product) {
                            cart.harga = item.harga_group
                        }
                    })
                    cart.qty = parseInt(cart.qty) + parseInt(qty)
                    carts[index] = cart
                }
            });
        } else {
            carts = []
        }

        if (!exists) {
            product.qty = parseInt(qty)
            if (newHargaProduk) {
                newHargaProduk.forEach((item, index)=>{
                    // console.log(product);
                    // console.log(item);
                    if (product.id == item.id_product) {
                        product.harga = item.harga_group
                        console.log(item.harga_group)
                    }
                })
            }
            carts.push(product)
        }

        updateCart(carts)
        saveToSession(carts);
    }

    let removeCart = []
    let cartId = 0
    let tmpCart = []

    function updateCart(newcarts) {
        let total = 0
        let cart = 0
        $('#cart-content').empty()
        $('#tbody-cart').empty()
        tmpCart = newcarts

        newcarts.forEach((product, index) => {
            removeCart.push(product)
            cart += parseInt(product.qty)
            total += parseInt(product.harga) * parseInt(product.qty)
            template = `
                    <a class="list-group-item dropdown-item waves-effect waves-light waves-round" href="javascript:void(0)">
                        <div class="media">
                            <div class="pr-10 remove-from-cart" data-id="${index}">
                                <i class="icon md-close-circle-o bg-red-600 white icon-circle" aria-hidden="true"></i>
                            </div>
                            <div class="media-body"  role="menuitem" data-target="#validasiNotifikasi" data-toggle="modal">
                                <h6 class="media-heading">${ product.nama }</h6>
                                <time class="media-meta" datetime="2017-06-12T20:50:48+08:00">${ product.qty } Buah</time>
                            </div>
                        </div>
                    </a>`
            $('#cart-content').append(template)

            template =
                `<tr style="text-align: center";>
                        <td>${ index+1 }.</td>
                        <td><a class="waves-effect waves-light waves-round" style="text-decoration:none" href="{{ url('product') }}/` + (product.id - 1) + `"> ${ product.nama } </a></td>
                        <td>
                            <span class="text-muted"><i class="icon md-time"></i> ${ '{{date('D, d-m-Y')}}' }</span>
                        </td>
                        <td><input type="text" class="form-control qty" style="text-center" id="catatan"/>
                        <td>${ product.qty }
                        </td>
                        <td>Rp ${ (parseInt(product.qty) * parseInt(product.harga_user[0].harga_user)).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.") }</td>
                        <td><i class="icon md-close-circle-o bg-red-600 white icon-circle remove-from-cart" aria-hidden="true" style="cursor: pointer" data-id="${index}"></i></td>
                    </tr>`

            $('#tbody-cart').append(template)
        });

        $('.badge-cart').html(cart)
        $('#nominal-total').html(total)
    }
    $(document).on('click', '.remove-from-cart', function() {
        console.log('id ', $(this).data('id'));
        cartId = $(this).data('id');
        carts = []
        for (let i = 0; i < tmpCart.length; i++) {
            if (i != cartId) {
                carts.push(tmpCart[i])
            }
        }
        updateCart(carts)
        removeFromSession(carts)
    })

    function removeFromSession(carts) {
        $.ajax({
            url: '{{ url('/session/save') }}',
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content'),
                key: KEY_SESSION_CART,
                data: carts
            },
            success: (response) => toastr["warning"]('Berhasil menghapus produk dari keranjang')
        })
    }

    function saveToSession(carts) {
        $.ajax({
            url: '{{ url('/session/save') }}',
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content'),
                key: KEY_SESSION_CART,
                data: carts
            },
            success: (response) => toastr["success"]('Berhasil menambahkan product ke dalam keranjang. Selamat Berbelanjaaa....')
        })
    }

    function buy(carts, total) {
        console.log(carts, total)
        var url = "{{url('/order') }}";

        if(total == 0)
            toastr["error"]('Keranjang kosong')
        else
        $.ajax({
            url: `{{ url('/order/purchase-order') }}`,
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content'),
                total: total,
                data: carts
            },
            success: (response) => {
                // toastr.options.onHidden = function() {
                //     window.location.reload()
                // }
                console.log(response)
                carts = []
                $.ajax({
                    url: `{{ url('/session/save') }}`,
                    type: 'POST',
                    async: false,
                    data: {
                        _token: $('meta[name="csrf-token"]').attr('content'),
                        key: KEY_SESSION_CART,
                        data: carts
                    }
                })
                updateCart(carts)
                $(location).attr('href',url);
                // window.location.href="{{ url('/order') }}"
                toastr["info"]('Transaksi sukses')
            }
        })
    }

    function singleBuy(carts, total) {
        $.ajax({
            url: `{{ url('/order/purchase-order') }}`,
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content'),
                total: total,
                data: carts
            },
            success: (response) => {
                toastr["info"]('Transaksi sukses')
            },
            error: (response) => {
                console.log(response)
                toastr["error"]('Transaksi gagal :(')
            }
        })
    }

    function singleBuyDetail(carts, total, dbutton) {
        $.ajax({
            url: `{{ url('/order/purchase-order') }}`,
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content'),
                total: total,
                data: carts
            },
            success: (response) => {
                toastr["info"]('Transaksi sukses')
                dbutton.removeAttr('disabled')
            }
        })
    }

    // internal library
    function formValidation({
        element: $element,
        action: action,
        fields: fields,
        method: method,
        targetUri: targetUri,
        strMessageSuccess: strMessageSuccess,
        reloadAfterSuccess: reloadAfterSuccess,
        success: success,
        strMessageError: strMessageError,
        error: error
    }) {
        return $element.formValidation({
            framework: "bootstrap4",
            button: {
                selector: action
            },
            icon: null,
            fields: fields,
            err: {
                clazz: 'invalid-feedback'
            },
            control: {
                // The CSS class for valid control
                valid: 'is-valid',
                // The CSS class for invalid control
                invalid: 'is-invalid'
            },
            row: {
                invalid: 'has-danger'
            }
        }).on('success.form.fv', function(e) {
            // console.log(new FormData($element.get(0)))
            $.ajax({
                url: targetUri,
                type: method != null ? method : 'POST',
                dataType: "JSON",
                data: new FormData($element.get(0)),
                processData: false,
                contentType: false,
                success: (response) => {
                    // console.log('--- response success --')
                    // console.log(response)
                    if (success != null) success();

                    toastr.options.onShown = () => window.location.reload(true);
                    toastr["success"](strMessageSuccess != null ? strMessageSuccess : 'Berhasil!')
                },
                error: (response) => {
                    // console.log('--- response error ---')
                    if (error != null) error();

                    // toastr.options.onShown = () => window.location.reload(true);
                    toastr["error"](strMessageError != null ? strMessageError : 'Gagal!')
                }
            });
        });
    }
</script>

@yield('js')
<script type="text/javascript">
@auth
var check_cod;
var table_cart_ndess;
var user = {{Auth::user()->id}}
table_cart_ndess = $('#table-cart-header').DataTable({
    searching: false,
    processing: true,
     serverSide: true,
     searching: false,
     paging: false,
     bInfo: false,
     ajax: {
       url: '{{route('json_cartAll')}}',
       type: "POST",
       data: function (d) {
           d._token = "{{ csrf_token() }}";
           d.user = user;
       }
     },
     columns: [
       { data: 'name' },
       { data: 'tanggal' },
       // { data: '' },
       { data: 'qty' },
       { data: 'total' },
       {
        data: null,
        render: function(data, type, full, meta){
         return '<a href="#" data-cart-id="'+data['id']+'" onclick="deleteThis(event)" class="btn btn-sm text-white btn-visitor-delete" style="background:#e74c3c">Hapus</a>';
       }
     },
      ],
  });
  function deleteThis(e){
    $.ajax({
        type:'post',
        url:'{{route('delete_cart')}}',
        data:{
           "_token": "{{ csrf_token() }}",
          cart_id:e.target.getAttribute('data-cart-id'),
          users : user,
        },
        success:function(data){
            console.log(data)
            $("#keranjang_count").text(data)
            table_cart_ndess.ajax.reload()
            cart_count()
            cart()
            if (data == 0) {
              document.getElementById("btn-buy").disabled = true;
            }
        },
        error: function(e){
            alert(e.error);
        }
    });
  }
  @endauth
$( document ).ready(function() {
  cart()
  cart_count()
  @auth
  $('#jenispembayaran_select').change(function() {
    if (this.value == 'transfer') {
      check_cod = 0;
    } else {
      check_cod = 1;
    }
  });
  var user = {{Auth::user()->id}}
  $('#btn-buy').click(function(){

    var user = {{Auth::user()->id}}
    $.ajax({
        url:"{{ route('storeOrder') }}",
        method:'POST',
        data:{
            "_token": "{{ csrf_token() }}",
            id_user : user,
            cod: check_cod
            },
        dataType:'json',
        success:function(data)
        {
          table_cart_ndess.clear().draw();
          cart()
          cart_count()
          toastr["success"]('Transaksi sukses')
          $('#validasiNotifikasi').modal('hide');
        },
        error: (err) => {
            toastr["error"]('Transaksi gagal')
        }
    })
  })
    @endauth
});
@auth
function cart()
{
    var user = {{Auth::user()->id}}
    $.ajax({
        url:"{{ route('cartData') }}",
        method:'POST',
        data:{
            "_token": "{{ csrf_token() }}",
            id_user : user
            },
        dataType:'json',
        success:function(data)
        {
            $('#products').html(data.cart_data)
        }
    })
}
function cart_count()
{
var user = {{Auth::user()->id}}
$.ajax({
  url:"{{route('cartData')}}",
  method:"POST",
  data:{
    "_token": "{{ csrf_token() }}",
    id_user : user
  },
  dataType:'json',
  success:function(data){
    if (data.get_total > 0) {
      document.getElementById("btn-buy").disabled = false;
    }
    $("#keranjang_count").text(data.get_total)
    $("#nominal-total").text(data.total_harga)
    cart()
  }
});}
@endauth
</script>
</body>

</html>
